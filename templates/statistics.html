{% extends 'app.html' %}

{% block head %}
<title>Showering App - Statistics</title>
{% endblock %}

{% block body %}
<div class="flex flex-col py-1 space-y-1.5">
    <div class="flex flex-row border py-2 text-sm justify-around rounded-sm bg-white">
        <a href="{{ url_for('statistics', timeframe='days', period=get_date_range('days')) }}" {% if timeframe == 'days' %} class="font-bold" {% endif %}>1d</a>
        <a href="{{ url_for('statistics', timeframe='weeks', period=get_date_range('weeks')) }}" {% if timeframe == 'weeks' %} class="font-bold" {% endif %}>7d</a>
        <a href="{{ url_for('statistics', timeframe='months', period=get_date_range('months')) }}" {% if timeframe == 'months' %} class="font-bold" {% endif %}>4w</a>
        <a href="{{ url_for('statistics', timeframe='years', period=get_date_range('years')) }}" {% if timeframe == 'years' %} class="font-bold" {% endif %}>1y</a>
    </div>
    <div class="flex flex-col px-3 py-3 border space-y-2 bg-white">
        <span>This period</span>
        <div class="flex justify-around px-4 py-1 text-sm">
            <div class="flex flex-col items-center">
                <span><span class="text-base font-semibold">8.5</span>min</span>
                <span>Average showertime</span>
            </div>
            <div class="flex flex-col items-center">
                <span><span class="text-base font-semibold">34.2</span>&#8451</span>
                <span>Average temperature</span>
            </div>
        </div>
    </div>
    {% if timeframe == 'days' %}
    {% elif timeframe == 'weeks' %}
        <div class="flex flex-col px-3 py-3 border space-y-2 bg-white">
            <span>Last 7 days average duration</span>
            <div>
                <canvas id="DurationChart"></canvas>
            </div>
        </div>
        <div class="flex flex-col px-3 py-3 border space-y-2 bg-white">
            <span>Last 7 days average temperature</span>
            <div>
                <canvas id="TemperatureChart"></canvas>
            </div>
        </div>
    {% elif timeframe == 'months' %}
        <div class="flex flex-col px-3 py-3 border space-y-2 bg-white">
            <span>Last 4 weeks average temperature</span>
            <div>
                <canvas id="DurationChart"></canvas>
            </div>
        </div>
        <div class="flex flex-col px-3 py-3 border space-y-2 bg-white">
            <span>Last 4 weeks average duration</span>
            <div>
                <canvas id="TemperatureChart"></canvas>
            </div>
        </div>
    {% elif timeframe == 'years' %}
        <div class="flex flex-col px-3 py-3 border space-y-2 bg-white">
            <span>Last year duration shower</span>
            <div>
                <canvas id="DurationChart"></canvas>
            </div>
        </div>
        <div class="flex flex-col px-3 py-3 border space-y-2 bg-white">
            <span>Last year average temperature</span>
            <div>
                <canvas id="TemperatureChart"></canvas>
            </div>
        </div>
    {% endif %}
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    {% if timeframe == 'weeks' %}
    const labels = [
        {% for data in data %}
            "{{ data[2].strftime("%A") }}",
        {% endfor %}
    ];
    {% elif timeframe == 'months' %}
    const labels = [
        {% for data in data %}
            "{{ data[2].strftime("%d") }}-{{ data[2].strftime("%b") }}",
        {% endfor %}
    ];
    {% elif timeframe == 'years' %}
    const labels = [
        {% for data in data %}
            "{{ data[2].strftime("%d") }}-{{ data[2].strftime("%m") }}-{{ data[2].strftime("%Y") }}",
        {% endfor %}
    ];
    {% endif %}

    const temperatureData = {
        labels: labels,
        datasets: [{
            label: 'Temperature',
            backgroundColor: 'rgb(255, 99, 132)',
            borderColor: 'rgb(255, 99, 132)',
            data: [
                    {% for data in data %}
                        {{ data[0] }},
                    {% endfor %}
            ],
        }]
    };
    const durationData = {
        labels: labels,
        datasets: [{
            label: 'Duration',
            backgroundColor: 'rgb(255, 99, 132)',
            borderColor: 'rgb(255, 99, 132)',
            data: [{% for data in data %}
                        {{ data[1] }},
                    {% endfor %}],
        }]
    };

    const temperatureConfig = {
        type: 'line',
        data: temperatureData,
        options: {
            scales: {
                y: {
                    beginAtZero: true,
                    suggestedMax: 50
                }
            }
        }
    };
    const durationConfig = {
        type: 'line',
        data: durationData,
        options: {
            scales: {
                y: {
                    beginAtZero: true,
                    suggestedMax: 30
                }
            }
        }
    };
</script>
<script>
const temperatureChart = new Chart(
        document.getElementById('TemperatureChart'),
        temperatureConfig
    );
const durationChart = new Chart(
        document.getElementById('DurationChart'),
        durationConfig
    );
</script>
{% endblock %}


